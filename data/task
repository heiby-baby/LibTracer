Папка LD_PRELOAD_TEST - место где я тестировал работу с LD_PRELOAD
Папка Shared_Memory_TEST - место, где я тестировал работа с shared memory


1) сначала сделаю память + демон
    1.1 ) Надо юзать не свою реализацию функций, а ссылки на на оригинальные функции через dlsym так будет более производительно 

2) потом прикручу файлы + демон


Библиотека:
    Обертка для каждой функции которая записывает в shared memory перехваченный вызов

Демон:
    Считывает данные из shared memory раз в argv[1] секунд и записывает в argv[2] файл


Запускаем демон который проспатривает наш shared memory (мы должны правильно его проинициализировать)
После запускаем приложение через LD_PRELOAD=./inject.so ./main 


gcc -I. -shared -fPIC -o libtest.so lib.c

gcc -I. -L. main.c -o main -ltest -Wl,-rpath,.

gcc -shared -fPIC -o inject.so inject.c

https://habr.com/ru/articles/829334/1

shm_open: Открывает или создает объект разделяемой памяти POSIX.

int shm_open(const char *name, int oflag, mode_t mode);
name: Имя разделяемой памяти.

oflag: Флаги открытия (например, O_RDWR, O_CREAT).

mode: Режим доступа при создании (например, S_IRUSR | S_IWUSR).

Возвращает файловый дескриптор, к которому применимы такие же функции, как и к обычному файлу: ftruncate, close, fstat, fchmod и т.д.

shm_unlink: Удаляет объект разделяемой памяти POSIX.

int shm_unlink(const char *name);
name: Имя разделяемой памяти для удаления.

Важно помнить, что shm_unlink не освобождает память и она может продолжать использоваться другими процессами пока они ее не освободят.

Области разделяемой памяти, создаваемые с помощью shm_open, находятся в файловой системе "tempfs" — 
 виртуальной файловой системе, которая хранит файлы в оперативной памяти, а не на диске.
  Обычно эти файлы располагаются по пути /dev/shm.
   Далее мы можем «замапить» (привязать) участок разделяемой памяти в локальное
    адресное пространство процесса, используя mmap.
     В результате появится участок памяти, общий для всех процессов, открывших этот же shm-объект.


https://habr.com/ru/articles/122108/

Надо использовать симафоры